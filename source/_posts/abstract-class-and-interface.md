title: 对抽象类与接口的一点思考
date: 2015-12-02 21:55:47
tags:
categories: 编程实践
---

## 前言
之前写了一篇文章 [简洁代码之道（1）：用多态替代条件语句][1]，有人问实现多态的时候为什么用抽象类而不是接口。当时写文章的时候并没有想到这个问题。后来仔细想想，这的确是个值得探讨的问题。多态可以用抽象类或者接口实现，重点是应该用哪个？更大问题是，接口和抽象类有什么本质的区别？下面我们将讨论以下的问题：

- 抽象类和接口的对比
- 从 java 容器类的设计讨论抽象类和接口的应用
- 抽象类和接口的使用时机

## 抽象类与接口的对比
 参数	| 抽象类	| 接口
 ----   |  ---      |
 默认的方法实现 |	它可以有默认的方法实现	| 接口完全是抽象的。它根本不存在方法的实现 |
实现 |	子类使用extends关键字来继承抽象类。如果子类不是抽象类的话，它需要提供抽象类中所有声明的方法的实现。	| 子类使用关键字implements来实现接口。它需要提供接口中所有声明的方法的实现
构造器|	抽象类可以有构造器|	接口不能有构造器
与正常Java类的区别|	除了你不能实例化抽象类之外，它和普通Java类没有任何区别	|接口是完全不同的类型
访问修饰符|	抽象方法可以有public、protected和default这些修饰符	|接口方法默认修饰符是public。你不可以使用其它修饰符。
main方法|	抽象方法可以有main方法并且我们可以运行它|	接口没有main方法，因此我们不能运行它。
多继承	|抽象方法可以继承一个类和实现多个接口|	接口只可以继承一个或多个其它接口
速度|	它比接口速度要快|	接口是稍微有点慢的，因为它需要时间去寻找在类中实现的方法。
添加新方法|	如果你往抽象类中添加新的方法，你可以给它提供默认的实现。因此你不需要改变你现在的代码。	|如果你往接口中添加方法，那么你必须改变实现该接口的类。

抽象类和接口有不同，也有相似的地方。有些书把接口称作特殊的类，虽然不准确，但也有一定道理，接口能做的事情，抽象类也能做到，除了多重继承。正是因为这些相似的特性，让我们在使用它们的时候有了困惑：这里到底该用抽象类还是接口？

## 从 java 容器类的设计讨论抽象类和接口的应用
除了前面提到的一个问题：多态到底是用抽象类还是接口实现？我还看到有人评论说：现在都是提倡面向接口编程，使用抽象类的都被称为上世纪的老码农了。哈哈。看到这个说法我也是苦笑不得。不过，面向接口编程的确是一个趋势，java 8 已经支持接口实现默认方法和静态方法了，抽象类和接口之间的差异越来越小。闲话少说，我们开始讨论抽象类和接口的应用。

![full_container_taxonomy][2]

上图是 java 容器类的类继承关系。我们以容器类中 `ArrayList` 为例子来讨论抽象类和接口的应用。

### ArrayList 类继承关系
![ArrayList][3]

上图是 `ArrayList` 的类继承关系。可以看到，`ArrayList` 的继承关系中既使用了抽象类，也使用了接口。

- 最顶层的接口是 `Iterable`，表示这是可迭代的类型。所有容器类都是可迭代的，这是一个极高的抽象。
- 第二层的接口是 `Collection`，这是单一元素容器的接口。集合，列表都属于此类。
- 第三层的接口是 `List`，这是所有列表的接口。

通过三个接口，我们可以找到容器类的三个抽象特性，实现这些接口就意味着拥有这些接口的特性。

- `AbstractCollection` 实现了 `Collection` 中的部分方法。
- `AbstractList` 实现了 `AbstractCollection` 和 `List` 中的部分方法。

上面的抽象类提供了一些方法的默认实现，给具体类提供了复用代码。

### 纯抽象类实现
如果我们像一个老码农一样，用抽象类来实现上面的接口会有怎样的效果？那么，类图可能变成这样。

![AbtractList][4]

抽象类在这里存在着一个很大的问题，它不能多继承，在抽象的层次上没有接口高，也没有接口灵活。例如说：

    List + AbstractCollection -> AbstractList
    Set  + AbstractCollection -> AbstractSet
单纯用抽象类无法实现像接口一样灵活的扩展。

### 纯接口实现
如果我们像一个新码农一样，用纯接口来实现呢？

 ![InterfaceList][5]

这样写理论上没有问题，实际写代码的时候问题就来了。所有的接口都要提供实现，于是你不得不在各个实现类中重复代码。

### 总结
经过上面的讨论，我们得出两个结论：

- 抽象类和接口并不能互相替代。
- 抽象类和接口各有不可替代的作用。

从容器类的类关系图中可以看到，接口主要是用来抽象类型的共性，例如说，容器的可迭代特性。抽象类主要是给具体实现类提供重用的代码，例如说，`List` 的一些默认方法。

## 抽象类和接口的使用时机
那么，什么时候该用抽象类，什么时候该用接口呢？

要解决上面的问题，我们先从弄清楚抽象类和接口之间的关系。首先，我们都知道类对事物的抽象，定义了事物的属性和行为。而抽象类是不完全的类，具有抽象方法。接口则比类的抽象层次更高。所以，我们可以这样理解它们之间的关系：**类是对事物的抽象，抽象类是对类的抽象，接口是对抽象类的抽象。**

从这个角度来看 java 容器类，你会发现，它的设计正体现了这种关系。不是吗？从 `Iterable` 接口，到 `AbstractList` 抽象类，再到 `ArrayList` 类。

现在回答前面的问题：在设计类的时候，首先考虑用接口抽象出类的特性，当你发现某些方法可以复用的时候，可以使用抽象类来复用代码。简单说，**接口用于抽象事物的特性，抽象类用于代码复用**。

当然，不是所有类的设计都要从接口到抽象类，再到类。程序设计本就没有绝对的范式可以遵循。上面的说法只是提供一个角度来理解抽象类和接口的关系，每个人都会有自己的理解，有人认为两者一点关系都没有，这也有道理。总之，模式和语法是死的，人是活的。


*参考资料*
[Java抽象类与接口的区别][6]
[我如何理解Java中抽象类和接口][7]
[面向接口编程详解][8]


  [1]: http://blog.xiaohansong.com/2015/11/24/clean-code-polymorphism/
  [2]: http://7xjtfr.com1.z0.glb.clouddn.com/full_container_taxonomy.png
  [3]: http://7xjtfr.com1.z0.glb.clouddn.com/ArrayList.png
  [4]: http://7xjtfr.com1.z0.glb.clouddn.com/AbtractList.png
  [5]: http://7xjtfr.com1.z0.glb.clouddn.com/InterfaceList.png
  [6]: http://www.importnew.com/12399.html
  [7]: https://bxbxbai.github.io/2014/07/20/understood_abstract_class_and_interface/.glb.clouddn.com/InterfaceList.png
  [8]: http://www.uml.org.cn/mxdx/200904232.asp
